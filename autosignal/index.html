<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoSignal - AraÃ§ Sahibine UlaÅŸ</title>
    <style>
        /* AutoSignal KaranlÄ±k Tema (Dark Mode) */
        body { background-color: #000; color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; text-align: center; padding: 20px; margin: 0; }
        .container { max-width: 500px; margin: 40px auto; padding: 20px; }
        .logo { width: 120px; margin-bottom: 30px; border-radius: 20px; box-shadow: 0 4px 20px rgba(10, 132, 255, 0.2); }
        h2 { font-size: 24px; font-weight: 800; margin-bottom: 24px; color: #fff; letter-spacing: -0.5px; }
        
        /* YENÄ°: PLAKA GÄ°RÄ°Åž KUTUSU (MANUEL VEYA OTOMATÄ°K) */
        .plate-input { width: 100%; background: #1C1C1E; padding: 18px; border-radius: 16px; font-size: 32px; font-weight: 900; letter-spacing: 4px; margin-bottom: 24px; border: 2px solid #333; color: #fff; text-align: center; text-transform: uppercase; box-sizing: border-box; outline: none; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .plate-input:focus { border-color: #0A84FF; background: #252528; box-shadow: 0 0 0 4px rgba(10, 132, 255, 0.15); }
        .plate-input::placeholder { color: #444; font-weight: 800; letter-spacing: 2px; }
        .plate-input:read-only { background: #151515; border-color: #0A84FF; color: #0A84FF; cursor: default; }
        
        /* AdSense Reklam AlanlarÄ± */
        .ad-banner { background: #18181B; border: 1px dashed #444; padding: 30px 10px; margin: 24px 0; color: #777; border-radius: 12px; font-size: 14px;}
        
        /* HAZIR ÅžABLONLAR Ä°Ã‡Ä°N TASARIM */
        .templates-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; justify-content: center; }
        .template-chip { background: #2C2C2E; color: #fff; border: 1px solid #444; padding: 12px 18px; border-radius: 24px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; }
        .template-chip:hover { background: #3C3C3E; border-color: #0A84FF; transform: translateY(-2px); }
        .template-chip:active { transform: translateY(0); }

        textarea { width: 100%; height: 120px; background: #1C1C1E; color: #fff; border: 1px solid #333; border-radius: 16px; padding: 16px; box-sizing: border-box; margin-bottom: 8px; font-size: 16px; font-family: inherit; resize: none; transition: 0.3s; }
        textarea:focus { outline: none; border-color: #0A84FF; background: #252528; box-shadow: 0 0 0 4px rgba(10, 132, 255, 0.1); }
        
        /* KARAKTER SAYACI */
        .char-count { text-align: right; font-size: 13px; color: #888; margin-bottom: 24px; padding-right: 8px; font-weight: 500; }

        .btn-send { background: #fff; color: #000; font-weight: 800; width: 100%; padding: 20px; border: none; border-radius: 16px; font-size: 18px; letter-spacing: 0.5px; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1); }
        .btn-send:hover { background: #f0f0f0; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 255, 255, 0.15); }
        .btn-send:active { transform: translateY(0); }
        .btn-send:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; transform: none; }
        
        .divider { height: 1px; background: #333; margin: 40px 0; }
        
        .store-title { font-size: 15px; color: #aaa; margin-bottom: 20px; font-weight: 500; }
        .store-buttons { display: flex; justify-content: center; gap: 16px; }
        .store-btn { background: #1C1C1E; color: white; padding: 16px 24px; border-radius: 14px; text-decoration: none; font-size: 15px; font-weight: 600; border: 1px solid #444; flex: 1; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .store-btn:hover { background: #2C2C2E; border-color: #555; }
    </style>
</head>
<body>
    <div class="container">
        <img src="autosignallogo.png" alt="AutoSignal Logo" class="logo" onerror="this.style.display='none'">
        
        <h2>Sahibine Bildirim GÃ¶nder</h2>
        
        <input type="text" id="plateInput" class="plate-input" placeholder="34ABC123" maxlength="15" oninput="formatPlate(this)" autocomplete="off">

        <div class="ad-banner">Google AdSense Reklam AlanÄ± (Ãœst)</div>

        <div class="templates-container">
            <button class="template-chip" onclick="setTemplate('HatalÄ± park ettiniz, lÃ¼tfen aracÄ±nÄ±zÄ± Ã§ekin.')">HatalÄ± park</button>
            <button class="template-chip" onclick="setTemplate('AracÄ±nÄ±zÄ±n camÄ± aÃ§Ä±k kalmÄ±ÅŸ.')">Cam aÃ§Ä±k</button>
            <button class="template-chip" onclick="setTemplate('DÃ¶rtlÃ¼leriniz yanÄ±k kalmÄ±ÅŸ.')">DÃ¶rtlÃ¼ler yanÄ±k</button>
            <button class="template-chip" onclick="setTemplate('AracÄ±nÄ±zÄ±n kapÄ±sÄ± aÃ§Ä±k.')">KapÄ± aÃ§Ä±k</button>
        </div>

        <textarea id="messageInput" maxlength="100" oninput="updateCharCount()" placeholder="MesajÄ±nÄ±zÄ± buraya yazÄ±n veya Ã¼stten ÅŸablon seÃ§in..."></textarea>
        
        <div class="char-count" id="charCount">0/100</div>

        <button class="btn-send" id="sendBtn" onclick="sendMessage()">BÄ°LDÄ°RÄ°MÄ° GÃ–NDER</button>

        <div class="ad-banner">Google AdSense Reklam AlanÄ± (Alt)</div>

        <div class="divider"></div>
        
        <div class="store-title">AutoSignal'i Ä°ndirin, Kendi PlakanÄ±zÄ± Koruyun</div>
        <div class="store-buttons">
            <a href="#" class="store-btn">ðŸ“± App Store</a>
            <a href="#" class="store-btn">ðŸ¤– Google Play</a>
        </div>
    </div>

    <script>
        // Plaka girilirken boÅŸluklarÄ± ve Ã¶zel karakterleri silen, bÃ¼yÃ¼k harfe zorlayan fonksiyon
        function formatPlate(input) {
            let val = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            input.value = val;
        }

        // Åžablon butonlarÄ±na basÄ±ldÄ±ÄŸÄ±nda Ã§alÄ±ÅŸacak fonksiyon
        window.setTemplate = function(text) {
            const input = document.getElementById('messageInput');
            input.value = text;
            window.updateCharCount();
            input.focus(); 
        };

        // Karakter sayacÄ±nÄ± gÃ¼ncelleyen fonksiyon
        window.updateCharCount = function() {
            const input = document.getElementById('messageInput');
            const countDisplay = document.getElementById('charCount');
            countDisplay.innerText = input.value.length + "/100";
        };
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBk3c9DRwyBLC2QfrUA6fPxOTnyhom3au4",
            authDomain: "autosignal-873cd.firebaseapp.com",
            projectId: "autosignal-873cd",
            storageBucket: "autosignal-873cd.firebasestorage.app",
            messagingSenderId: "80739959987",
            appId: "1:80739959987:web:2a7f8d499df948a3e69cc6" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // URL'den plakayÄ± alma iÅŸlemi
        const urlParams = new URLSearchParams(window.location.search);
        const targetPlate = urlParams.get('plate');
        const plateInput = document.getElementById('plateInput');

        // EÄŸer kiÅŸi QR kodu okutup geldiyse (URL'de plaka varsa) kutuyu doldur ve kilitle!
        if(targetPlate && targetPlate.trim() !== "") {
            plateInput.value = targetPlate.toUpperCase().replace(/[^A-Z0-9]/g, '');
            plateInput.readOnly = true; // DeÄŸiÅŸtirilemez yap
            plateInput.placeholder = ""; 
        }

        // GÃ¼venli veritabanÄ± yazma iÅŸlemi iÃ§in anonim giriÅŸ
        signInAnonymously(auth).catch(error => console.error("Anonim GiriÅŸ HatasÄ±:", error));

        // Mesaj gÃ¶nderme asÄ±l fonksiyonu
        window.sendMessage = async function() {
            let finalPlate = document.getElementById('plateInput').value.trim();
            let msg = document.getElementById('messageInput').value.trim();
            
            // Hata Kontrolleri
            if(finalPlate === "") {
                alert("LÃ¼tfen bir plaka girin.");
                document.getElementById('plateInput').focus();
                return;
            }
            if(msg === "") {
                alert("LÃ¼tfen gÃ¶ndermeden Ã¶nce bir mesaj yazÄ±n.");
                document.getElementById('messageInput').focus();
                return;
            }

            if(msg.length > 100) {
                msg = msg.substring(0, 100);
            }

            const btn = document.getElementById('sendBtn');
            btn.innerText = "GÃ–NDERÄ°LÄ°YOR...";
            btn.style.background = "#0A84FF"; 
            btn.style.color = "#fff";
            btn.disabled = true;

            try {
                await addDoc(collection(db, "notifications"), {
                    targetPlate: finalPlate,
                    message: msg,
                    senderId: auth.currentUser ? auth.currentUser.uid : "web_anonymous",
                    timestamp: serverTimestamp(),
                    isRead: false
                });
                
                // BaÅŸarÄ±lÄ± olursa UX deÄŸiÅŸiklikleri
                btn.innerText = "BAÅžARIYLA GÃ–NDERÄ°LDÄ° âœ“";
                btn.style.background = "#32D74B"; 
                
                document.getElementById('messageInput').value = "";
                window.updateCharCount();

                // 3 saniye sonra butonu eski haline getir
                setTimeout(() => {
                    btn.innerText = "YENÄ° BÄ°LDÄ°RÄ°M GÃ–NDER";
                    btn.style.background = "#fff";
                    btn.style.color = "#000";
                    btn.disabled = false;
                }, 3000);

            } catch(e) {
                console.error("Hata:", e);
                alert("Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edip tekrar deneyin.");
                btn.innerText = "TEKRAR DENE";
                btn.style.background = "#FF453A"; 
                btn.style.color = "#fff";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
